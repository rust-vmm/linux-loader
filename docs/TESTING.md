# Testing `linux-loader`

## Tests

Our Continuous Integration (CI) pipeline is implemented on top of
[Buildkite](https://buildkite.com/).
For the complete list of tests, check our
[CI pipeline](https://buildkite.com/rust-vmm/rust-vmm-ci).

Each individual test runs in a container. To reproduce a test locally, you can
use the dev-container on both x86 and arm64.

```bash
container_version=11
docker run -it \
           --security-opt seccomp=unconfined \
           --volume $(pwd):/linux-loader \
           rustvmm/dev:v${container_version}
cd linux-loader/
cargo test --all-features
```

## Test Images

The kernel images used in the unit tests fall into 3 categories:
- downloaded from known distro sources using the
  [download script](../.buildkite/download_resources.sh).
- fuzzing images; these images were generated by fuzzers such as `libfuzzer` or
  `afl` starting from an existing image already used by the unit tests. These
  are named with `fuzz_` so that they are easy to identify.
- generated images (either by building the Linux kernel, or by using other
  tools such as [ELFIO](https://github.com/serge1/ELFIO)).

### Building the PE image

The PE image used by the linux-loader unit tests is built on an `aarch64`
machine using the following commands:

```bash
git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git
git checkout v4.20

# To be able to run the following command, you'll need to install
# flex and bison.
make allnoconfig
make Image
head -c 4096 arch/arm64/boot/Image > test_image.bin
```
